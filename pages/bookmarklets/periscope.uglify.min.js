"use strict";(()=>{(function(){function m(o){var t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");return t.appendChild(e),e.type="text/css",e.appendChild(document.createTextNode(o)),{unmountStyle:function(){e.parentNode.removeChild(e)},styleElement:e}}m(` #periscope_div { position: fixed; width: 200px; height: 200px; overflow: hidden; border: 1px solid gray; top: 0; left: 0; background-color: white; z-index:1000000; } #periscope_div video { border: 1px solid red; opacity: 0.5; height: 100vh; width: 100vw; } #periscope_div canvas { border: 1px solid green; } `);function f(o){var t=localStorage.getItem(o);if(t!==null){var e=parseInt(t,10);return isNaN(e)?t:e}}function v(o,t){t!==null&&typeof t<"u"&&localStorage.setItem(o,String(t))}function x(o){var t=window.getComputedStyle(o);return t}function w(o,t,e){var d=0,l=0,s=!1,c,r;o.addEventListener("mousedown",function(a){if(s=!0,d=a.pageX,l=a.pageY,typeof e=="function"){var i=e();c=i.x,r=i.y}else c=r=0;t(c+a.pageX-d,r+a.pageY-l,"mousedown")});function u(a){s&&(s=!1,t(c+a.pageX-d,r+a.pageY-l,"mouseup"))}o.addEventListener("mouseup",u),o.addEventListener("mouseout",u),o.addEventListener("mousemove",function(a){s&&t(c+a.pageX-d,r+a.pageY-l,"mousemove")})}var b=console.log;navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0,preferCurrentTab:!0}).then(function(o){var t={};document.addEventListener("keydown",function(i){t[i.key]=!0}),document.addEventListener("keyup",function(i){t[i.key]=!1});var e=document.createElement("div");e.setAttribute("id","periscope_div");var d=f("pw");d&&(e.style.width="".concat(d,"px"));var l=f("ph");l&&(e.style.height="".concat(l,"px"));var s=f("pl");s&&(e.style.left="".concat(s,"px"));var c=f("pt");c&&(e.style.top="".concat(c,"px")),w(e,function(i,n){if(t.Shift)e.style.width="".concat(i,"px"),e.style.height="".concat(n,"px"),v("pw",i),v("ph",n);else if(!t.Meta){e.style.left="".concat(i,"px"),e.style.top="".concat(n,"px"),v("pl",i),v("pt",n);return}},function(){if(t.Shift){var i=x(e),n={x:parseInt(i.width,10)||0,y:parseInt(i.height,10)||0};return n}return{x:parseInt(e.style.left,10)||0,y:parseInt(e.style.top,10)||0}}),document.body.appendChild(e);var r=document.createElement("video");window.video=r,r.setAttribute("autoplay",!0),e.appendChild(r);var u=!1,a=function(){u=!1};r.addEventListener("ended",a),r.addEventListener("pause",a),r.addEventListener("play",function(i){b("play");var n=document.createElement("canvas");w(n,function(p,g){if(t.Meta){var y="translate(".concat(p,"px, ").concat(g,"px)");v("ct",y),n.style.transform=y}},function(){var p=(n.style.transform||"").match(/(-?\d+).*?(-?\d+)/)||[],g=parseInt(p[1],10)||0,y=parseInt(p[2],10)||0;return{x:g,y}}),e.insertBefore(n,e.firstChild),n.width=window.innerWidth,n.height=window.innerHeight,n.style.width="".concat(window.innerWidth,"px"),n.style.height="".concat(window.innerHeight,"px");var h=f("ct");h&&(n.style.transform=h),u=!0,function p(){u&&window.requestAnimationFrame(function(){n.width=window.innerWidth,n.height=window.innerHeight,n.style.width="".concat(window.innerWidth,"px"),n.style.height="".concat(window.innerHeight,"px"),console.log("w",window.innerWidth,"h",window.innerHeight),n.getContext("2d").drawImage(r,0,0,window.innerWidth,window.innerHeight),p()})}()}),r.srcObject=o})})();})();
