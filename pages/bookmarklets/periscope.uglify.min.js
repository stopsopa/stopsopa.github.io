"use strict";(()=>{(function(){function w(r){var n=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");return n.appendChild(e),e.type="text/css",e.appendChild(document.createTextNode(r)),{unmountStyle:function(){e.parentNode.removeChild(e)},styleElement:e}}w(` #periscope_div { position: fixed; width: 200px; height: 200px; overflow: hidden; border: 1px solid gray; top: 0; left: 0; background-color: white; z-index:1000000; } #periscope_div video { border: 1px solid red; opacity: 0.5; height: 100vh; width: 100vw; } #periscope_div canvas { border: 1px solid green; } `);function v(r){var n=localStorage.getItem(r);if(n!==null){var e=parseInt(n,10);return isNaN(e)?n:e}}function y(r,n){n!==null&&typeof n<"u"&&localStorage.setItem(r,String(n))}function x(r){return window.getComputedStyle(r)}function g(r,n,e){var a=0,l=0,s=!1,d,i;function p(u){if(s=!0,a=u.pageX,l=u.pageY,typeof e=="function"){var o=e();d=o.x,i=o.y}else d=i=0;n(d+u.pageX-a,i+u.pageY-l,"mousedown");function t(c){s&&n(d+c.pageX-a,i+c.pageY-l,"mousemove")}document.addEventListener("mouseup",function(c){document.removeEventListener("mousemove",t),s&&(s=!1,n(d+c.pageX-a,i+c.pageY-l,"mouseup"))}),document.addEventListener("mousemove",t)}r.addEventListener("mousedown",p)}var b=console.log;navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0,preferCurrentTab:!0}).then(function(r){var n={};document.addEventListener("keydown",function(o){n[o.key]=!0}),document.addEventListener("keyup",function(o){n[o.key]=!1});var e=document.createElement("div");e.setAttribute("id","periscope_div");var a=v("pw");a&&(e.style.width="".concat(a,"px"));var l=v("ph");l&&(e.style.height="".concat(l,"px"));var s=v("pl");s&&(e.style.left="".concat(s,"px"));var d=v("pt");d&&(e.style.top="".concat(d,"px")),g(e,function(o,t){if(n.Shift)e.style.width="".concat(o,"px"),e.style.height="".concat(t,"px"),y("pw",o),y("ph",t);else if(!n.Meta){e.style.left="".concat(o,"px"),e.style.top="".concat(t,"px"),y("pl",o),y("pt",t);return}},function(){if(n.Shift){var o=x(e),t={x:parseInt(o.width,10)||0,y:parseInt(o.height,10)||0};return t}return{x:parseInt(e.style.left,10)||0,y:parseInt(e.style.top,10)||0}}),document.body.appendChild(e);var i=document.createElement("video");window.video=i,i.setAttribute("autoplay",!0),e.appendChild(i);var p=!1,u=function(){p=!1};i.addEventListener("ended",u),i.addEventListener("pause",u),i.addEventListener("play",function(o){b("play");var t=document.createElement("canvas");g(t,function(f,m){if(n.Meta){var h="translate(".concat(f,"px, ").concat(m,"px)");y("ct",h),t.style.transform=h}},function(){var f=(t.style.transform||"").match(/(-?\d+).*?(-?\d+)/)||[],m=parseInt(f[1],10)||0,h=parseInt(f[2],10)||0;return{x:m,y:h}}),e.insertBefore(t,e.firstChild),t.width=window.innerWidth,t.height=window.innerHeight,t.style.width="".concat(window.innerWidth,"px"),t.style.height="".concat(window.innerHeight,"px");var c=v("ct");c&&(t.style.transform=c),p=!0,function f(){p&&window.requestAnimationFrame(function(){t.width=window.innerWidth,t.height=window.innerHeight,t.style.width="".concat(window.innerWidth,"px"),t.style.height="".concat(window.innerHeight,"px"),console.log("w",window.innerWidth,"h",window.innerHeight),t.getContext("2d").drawImage(i,0,0,window.innerWidth,window.innerHeight),f()})}()}),i.srcObject=r})})();})();
