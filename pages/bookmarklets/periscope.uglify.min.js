(()=>{(function(){function w(d){var n=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");return n.appendChild(e),e.type="text/css",e.appendChild(document.createTextNode(d)),{unmountStyle:()=>{e.parentNode.removeChild(e)},styleElement:e}}w(` #periscope_div { position: fixed; width: 200px; height: 200px; overflow: hidden; border: 1px solid gray; top: 0; left: 0; background-color: white; z-index:1000000; } #periscope_div video { border: 1px solid red; opacity: 0.5; height: 100vh; width: 100vw; } #periscope_div canvas { border: 1px solid green; } `);function f(d){let n=localStorage.getItem(d);if(n!==null){let e=parseInt(n,10);return isNaN(e)?n:e}}function h(d,n){n!==null&&typeof n<"u"&&localStorage.setItem(d,String(n))}function x(d){return window.getComputedStyle(d)}function y(d,n,e){let r=0,l=0,c=!1,s,i;function a(p){c=!0,r=p.pageX,l=p.pageY,typeof e=="function"?{x:s,y:i}=e():s=i=0,n(s+p.pageX-r,i+p.pageY-l,"mousedown");function o(t){c&&n(s+t.pageX-r,i+t.pageY-l,"mousemove")}document.addEventListener("mouseup",t=>{document.removeEventListener("mousemove",o),c&&(c=!1,n(s+t.pageX-r,i+t.pageY-l,"mouseup"))}),document.addEventListener("mousemove",o)}d.addEventListener("mousedown",a)}let b=console.log;navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0,preferCurrentTab:!0}).then(d=>{let n={};document.addEventListener("keydown",o=>{n[o.key]=!0}),document.addEventListener("keyup",o=>{n[o.key]=!1});let e=document.createElement("div");e.setAttribute("id","periscope_div");let r=f("pw");r&&(e.style.width=`${r}px`);let l=f("ph");l&&(e.style.height=`${l}px`);let c=f("pl");c&&(e.style.left=`${c}px`);let s=f("pt");s&&(e.style.top=`${s}px`),y(e,(o,t)=>{if(n.Shift)e.style.width=`${o}px`,e.style.height=`${t}px`,h("pw",o),h("ph",t);else if(!n.Meta){e.style.left=`${o}px`,e.style.top=`${t}px`,h("pl",o),h("pt",t);return}},()=>{if(n.Shift){let o=x(e);return{x:parseInt(o.width,10)||0,y:parseInt(o.height,10)||0}}return{x:parseInt(e.style.left,10)||0,y:parseInt(e.style.top,10)||0}}),document.body.appendChild(e);let i=document.createElement("video");window.video=i,i.setAttribute("autoplay",!0),e.appendChild(i);let a=!1,p=()=>{a=!1};i.addEventListener("ended",p),i.addEventListener("pause",p),i.addEventListener("play",o=>{b("play");let t=document.createElement("canvas");y(t,(u,g)=>{if(n.Meta){let v=`translate(${u}px, ${g}px)`;h("ct",v),t.style.transform=v}},()=>{let u=(t.style.transform||"").match(/(-?\d+).*?(-?\d+)/)||[],g=parseInt(u[1],10)||0,v=parseInt(u[2],10)||0;return{x:g,y:v}}),e.insertBefore(t,e.firstChild),t.width=window.innerWidth,t.height=window.innerHeight,t.style.width=`${window.innerWidth}px`,t.style.height=`${window.innerHeight}px`;let m=f("ct");m&&(t.style.transform=m),a=!0,function u(){a&&window.requestAnimationFrame(()=>{t.width=window.innerWidth,t.height=window.innerHeight,t.style.width=`${window.innerWidth}px`,t.style.height=`${window.innerHeight}px`,console.log("w",window.innerWidth,"h",window.innerHeight),t.getContext("2d").drawImage(i,0,0,window.innerWidth,window.innerHeight),u()})}()}),i.srcObject=d})})();})();
