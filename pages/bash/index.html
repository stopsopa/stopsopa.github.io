<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>stopsopa.github.io</title>
    <script src="/js/github.js"></script>
</head>
<body class="layout" toc>

    <div class="body">
        <div class="inside">
            <div class="cards">
                
                <h2>debug</h2>
                <script type="editor" data-lang="sh">
                
set -x          # Expand and print each command before executing
set -e          # Exit script immediately if any command returns a non-zero exit status.
set -o pipefail # more: https://buildkite.com/docs/pipelines/writing-build-scripts#configuring-bash

set -u # Exit script immediately if an undefined variable is used (e.g. echo "$UNDEFINED_ENV_VAR").

                </script>
                
                <h2>top</h2>
                <script type="editor" data-lang="sh">
                
z,x,E,e,>>,W

b - refresh
E - change size units (tob summary bar)
x - Toggle highlights
R - normal/reverse sort
s - update interval 0.05
W - save settings in ~/.toprc
k - kill process

> <  - change sort table

  # mac:   brew install htop

                </script>
                
                <h2>useful links</h2>
                <ul>
                    <li><a href="https://buildkite.com/docs/pipelines/writing-build-scripts#configuring-bash">buildkite script guide ("Writing Build Scripts" section in doc)</a></li>
                </ul>

                <h2>useful commands</h2>
                <script type="editor" data-lang="sh">
                
grep 'swap-files' * -rl --exclude-dir={bower_components,node_modules,vendor} --include \*.sh   

arch -arm64 brew install webp
sudo xattr -dr com.apple.quarantine /path/ff*

# get ip
IP=$(ipconfig getifaddr en0)

                </script>

                <h2>verifying default shell</h2>
                <script type="editor" data-lang="sh">
                
 echo $SHELL 
 
 # change default shell
 chsh -s /bin/bash
 chsh -s /bin/zsh

                </script>
            </div>
            <div class="cards">

                <h2>export .env</h2>
                <script type="editor" data-lang="sh">
                
# https://unix.stackexchange.com/a/79084
set -a
source ".env"
set +a   

                </script>
            </div>
            <div class="cards">

                <h2>trap</h2>
                <script type="editor" data-lang="sh">
# this example is little messy but I need it just as an example                
  # advanced use ------------------------------------------------- vvv

DELETE=("$DOC" "$IGN" "$RUN");

function cleanup {

  set +x

  for i in "${DELETE[@]}"
  do

      { yellow "\nremoving '$i'"; } 2>&3

      unlink "$i" || true
  done
}

trap cleanup EXIT;

# ...
DELETE+=("$DEPLOYMENT_FILE")
# ...

trap - EXIT

  # advanced use ------------------------------------------------- ^^^


        # ===== multiple traps =============== vvv

TRAPS=()

function trigger_traps {

  for i in "${TRAPS[@]}"
  do

      { yellow "\ntriggering trap: '$i'"; } 2>&3

      $i || true
  done
}

trap trigger_traps EXIT;


function final { { red "\n\ngeneral error...\n\n"; } 2>&3;}
TRAPS+=('final')

# do yours stuff ....

function final { { green "\n\nall good...\n\n"; } 2>&3;}

# and then


function cleanup {

  echo "======================== first cleanup ===========================";

  set +x

  for i in "${DELETE[@]}"
  do

      { yellow "\nremoving '$i'"; } 2>&3

      unlink "$i" || true
  done
}  

TRAPS=("cleanup" "${TRAPS[@]}") # add to beginning of the array
TRAPS+=('cleanup') # add to the end of array

        # ===== multiple traps =============== ^^^

                </script>
            </div>

            <div class="cards">

                <h2>bash colors</h2>

                oneliner:
                <script type="editor" data-lang="sh">
if cat ~/.bashrc 2> /dev/null | grep '#colors mod' > /dev/null; then echo -e "\033[31m -=file .bashrc have been already modified before=-"; else echo -e "\n#colors mod\nexport EDITOR=vi\ncolor_prompt=yes;\nPS1='${debian_chroot:+($debian_chroot)}\[\033[`if [ "$(id -u)" != "0" ]; then echo '00;32'; else echo '1;30'; fi`m\]\u@\h\[\033[00;31m\]:\[\033[01;34m\]\w\[\033[00;33m\]\$ '\nalias ls='ls --color=auto'\nalias dir='dir --color=auto'\nalias ll='ls -alF'\nalias vdir='vdir --color=auto'\nalias grep='grep --color=auto'\nalias fgrep='fgrep --color=auto'\nalias egrep='egrep --color=auto'\neval \"`dircolors -b`\"\nexport HISTCONTROL=ignoreboth:erasedups\nalias con=\"php app/console\"\nalias c=\"/bin/bash clean.sh\"\n" >> ~/.bashrc && source ~/.bashrc && echo -e "\033[32m -= .bashrc has been modified =-"; fi &&        if cat ~/.vimrc 2> /dev/null | grep '" colors mod' > /dev/null; then echo -e "\033[31m -=file .vimrc has been already modified before=-"; else echo -e "\n\" colors mod\n:set number\n:set hlsearch\n:syntax on\n" >> ~/.vimrc && echo -e "\033[32m -= .vimrc has been modified =-"; fi        &&  history -d `history | tail -n 1 | sed -r 's#\s*([0-9]*).*#\1#'` && if [ ! -f ~/.history_backup ] ; then history > ~/.history_backup; fi
                </script>

                full:
                <script type="editor" data-lang="sh">

if cat ~/.bashrc 2> /dev/null | grep '#colors mod' > /dev/null; then
    echo -e "\033[31m -=file .bashrc have been already modified before=-"
else
    echo -e "\n#colors mod\nexport EDITOR=vi\ncolor_prompt=yes;\nPS1='${debian_chroot:+($debian_chroot)}\[\033[`if [ "$(id -u)" != "0" ]; then echo '00;32'; else echo '1;30'; fi`m\]\u@\h\[\033[00;31m\]:\[\033[01;34m\]\w\[\033[00;33m\]\$ '\nalias ls='ls --color=auto'\nalias dir='dir --color=auto'\nalias vdir='vdir --color=auto'\nalias grep='grep --color=auto'\nalias fgrep='fgrep --color=auto'\nalias egrep='egrep --color=auto'\neval \"`dircolors -b`\"\nexport HISTCONTROL=ignoreboth:erasedups\nalias con=\"php app/console\"\nalias c=\"/bin/bash clean.sh\"\n" >> ~/.bashrc
    source ~/.bashrc
    echo -e "\033[32m -= .bashrc has been modified =-";
fi

if cat ~/.vimrc 2> /dev/null | grep '" colors mod' > /dev/null; then
    echo -e "\033[31m -=file .vimrc has been already modified before=-"
else
    echo -e "\n\" colors mod\n:set number\n:set hlsearch\n:syntax on\n" >> ~/.vimrc
    echo -e "\033[32m -= .vimrc has been modified =-";
fi

if [ ! -f ~/.history_backup ] ; then
    history > ~/.history_backup
fi

                </script>
            </div>
            <div class="cards">

                <h2>ping through dns</h2>
                <script type="editor" data-lang="sh">
                
while true; do ping -n -q -c1 docker.phaseiilabs.com | grep '('; sleep 2; done                

                </script>
            </div>
            <div class="cards">

                <h2>Processing arguments</h2>
                <script type="editor" data-lang="sh">


echo "args: '$@'"

_CLEANOLD="0";

_GEN="gen"

_DEPLOYMENT_YAML=""

PARAMS=""
_EVAL=""
while (( "$#" )); do
  case "$1" in
    -c|--clean|--clear)
      _CLEANOLD="1";
      shift;
      ;;
    -d|--deployment-yaml)
      if [ "$2" = "" ]; then                            # PUT THIS CHECKING ALWAYS HERE IF YOU WAITING FOR VALUE
        echo "$0 Error: --deployment-yaml value can't be empty" >&2 # optional
        exit 1;                                          # optional
      fi
      if ! [ -f "$2" ]; then
        echo "$0 Error: --deployment-yaml file '$2' doesn't exist" >&2 # optional
        exit 1;                                          # optional
      fi                                           # optional
      _DEPLOYMENT_YAML="$2";
      shift 2;
      ;;
    -g|--gen)
      if [ "$2" = "" ]; then                            # PUT THIS CHECKING ALWAYS HERE IF YOU WAITING FOR VALUE
        echo "$0 Error: --gen value can't be empty" >&2 # optional
        exit 1;                                          # optional
      fi                                                # optional
      _GEN="$2";
      shift 2;
      ;;
    --) # end argument parsing
      shift;
      while (( "$#" )); do          # optional
        if [ "$1" = "&&" ]; then
          PARAMS="$PARAMS \&\&"
          _EVAL="$_EVAL &&"
        else
          if [ "$PARAMS" = "" ]; then
            PARAMS="\"$1\""
            _EVAL="\"$1\""
          else
            PARAMS="$PARAMS \"$1\""
            _EVAL="$_EVAL \"$1\""
#          PARAMS="$(cat <<EOF
#$PARAMS
#- "$1"
#EOF
#)"
          fi
        fi
        echo "                PARAMS1>>$PARAMS<<"
        echo "                _EVAL 2>>$_EVAL<<"
        shift;                      # optional
      done                          # optional if you need to pass: /bin/bash $0 -f -c -- -f "multi string arg"
      break;
      ;;
    -*|--*=) # unsupported flags
      echo "$0 Error: Unsupported flag $1" >&2
      exit 1;
      ;;
    *) # preserve positional arguments
      if [ "$1" = "&&" ]; then
          PARAMS="$PARAMS \&\&"
          _EVAL="$_EVAL &&"
      else
        if [ "$PARAMS" = "" ]; then
            PARAMS="\"$1\""
            _EVAL="\"$1\""
        else
          PARAMS="$PARAMS \"$1\""
            _EVAL="$_EVAL \"$1\""
#          PARAMS="$(cat <<EOF
#$PARAMS
#- "$1"
#EOF
#)"
        fi
      fi
      echo "                PARAMS2>>$PARAMS<<"
      echo "                _EVAL 1>>$_EVAL<<"
      shift;
      ;;
  esac
done

trim() {
    local var="$*"
    # remove leading whitespace characters
    var="${var#"${var%%[![:space:]]*}"}"
    # remove trailing whitespace characters
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

PARAMS="$(trim "$PARAMS")"
_EVAL="$(trim "$_EVAL")"

#if [ "$_DEPLOYMENT_YAML" = "" ]; then
#
#    echo -e "\n\n$0 error: parameter _DEPLOYMENT_YAML is not defined - spedify it in --deployment-yaml parameter\n\n";
#
#    exit 1;
#fi

# set positional arguments in their proper place
eval set -- "$PARAMS"

echo "_CLEANOLD: $_CLEANOLD"
echo "_GEN: $_GEN"

echo "rest: '$@'"

echo "count: $#"


if [[ $# -gt 0 ]]; then

  echo there are arguments

  while (( "$#" )); do
    echo "arg: '$1'"
    shift;
  done
else

  echo there is no arguments
fi

echo "PARAMS>>$PARAMS<<"
echo "_EVAL>>$_EVAL<<"

eval "$_EVAL"

# when you run
#   /bin/bash arg.sh --gen test -c -- echo "one"     \&\& pwd \&\& echo "two three"
# the output will be:

#args: '--gen test -c -- echo one && pwd && echo two three'
#                PARAMS1>>"echo"<<
#                _EVAL 2>>"echo"<<
#                PARAMS1>>"echo" "one"<<
#                _EVAL 2>>"echo" "one"<<
#                PARAMS1>>"echo" "one" \&\&<<
#                _EVAL 2>>"echo" "one" &&<<
#                PARAMS1>>"echo" "one" \&\& "pwd"<<
#                _EVAL 2>>"echo" "one" && "pwd"<<
#                PARAMS1>>"echo" "one" \&\& "pwd" \&\&<<
#                _EVAL 2>>"echo" "one" && "pwd" &&<<
#                PARAMS1>>"echo" "one" \&\& "pwd" \&\& "echo"<<
#                _EVAL 2>>"echo" "one" && "pwd" && "echo"<<
#                PARAMS1>>"echo" "one" \&\& "pwd" \&\& "echo" "two three"<<
#                _EVAL 2>>"echo" "one" && "pwd" && "echo" "two three"<<
#_CLEANOLD: 1
#_GEN: test
#rest: 'echo one && pwd && echo two three'
#count: 7
#there are arguments
#arg: 'echo'
#arg: 'one'
#arg: '&&'
#arg: 'pwd'
#arg: '&&'
#arg: 'echo'
#arg: 'two three'
#PARAMS>>"echo" "one" \&\& "pwd" \&\& "echo" "two three"<<
#_EVAL>>"echo" "one" && "pwd" && "echo" "two three"<<
#one
#/Users/sd/Workspace/projects/monorepo/runtime
#two three

# then you can use $_EVAL like this:
eval $_EVAL

                </script>
                <a href="https://medium.com/@Drew_Stokes/bash-argument-parsing-54f3b81a6a8f">https://medium.com/@Drew_Stokes/bash-argument-parsing-54f3b81a6a8f</a>
            </div>
            <div class="cards">

                <h2>basic auth generator</h2>
                <table>
                    <tbody>
                    <tr>
                        <td width="60">
                            user:
                        </td>
                        <td>
                            <input type="text" id="user">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            password:
                        </td>
                        <td>
                            <input type="text" id="password">
                        </td>
                    </tr>
                    </tbody>
                </table>
                <input type="text" style="width: 80%" id="raw" readonly onfocus="this.select()">
                <input type="text" style="width: 80%" id="header" readonly onfocus="this.select()">
                <input type="text" style="width: 80%" id="curl" readonly onfocus="this.select()">
            </div>
            <div class="cards">

                <h2>HEREDOC:</h2>
                <script type="editor" data-lang="sh">
VAR=$(cat <<END

..

END
);                
                
cat <<EOF > .env

..

EOF

cat <<EOF

..

EOF

# QUOTING TEST vvv
export TTTA="outputvariable"
export TTTB="outputvalue"

# one level
cat <<EEE

echo "variable: \$TTTA"

echo "value: $TTTB"

EEE

# two levels
cat <<EOF > ./ttt.sh

cat <<EEE

echo "variable: \\\$TTTA"

echo "value: \$TTTB"

EEE

EOF

/bin/bash ttt.sh
# QUOTING TEST ^^^

# preventing variables to expand
cat << 'EOF' > aaaa.sh
#!/bin/bash

echo "Using \"\$*\":"
for a in "$*"; do
    echo $a;
done

echo -e "\nUsing \$*:"
for a in $*; do
    echo $a;
done

echo -e "\nUsing \"\$@\":"
for a in "$@"; do
    echo $a;
done

echo -e "\nUsing \$@:"
for a in $@; do
    echo $a;
done
EOF

/bin/bash aaaa.sh one two "three four"
rm -rf aaaa.sh


                </script>
            </div>
        </div>
    </div>
    <script>
        var user        = document.querySelector('#user');
        var password    = document.querySelector('#password');
        var raw         = document.querySelector('#raw');
        var header      = document.querySelector('#header');
        var curl        = document.querySelector('#curl');

        user.addEventListener('input', generate);

        password.addEventListener('input', generate);

        function generate() {

            setTimeout(function () {

                var u = user.value;
                var p = password.value;

                if (u && p) {
                    console.log(u + ':::' + p)
                    var k = btoa(u + ':' + p)
                    raw.value = k
                    header.value = "Basic " + k;
                    curl.value = 'curl -v --silent -H "authorization: Basic ' + k + '"';
                }
            }, 50);

        }

        (function () {

            var q = location.search.split('#')[0].substring(1);

            if (q.length > 2 && q.indexOf(':') > -1) {

                q = q.split(':');

                console.log('q', q[0], 'a', q[1])

                user.value      = q[0];

                password.value  = q[1];

                generate()
            }
            else {

                generate()
            }
        }());
    </script>
</body>
</html>
