<div class="buttons-container">
  <button id="show-btn" class="btn">showPopover()</button>
  <button id="hide-btn" class="btn">hidePopover()</button>
  <button id="toggle-btn" class="btn">togglePopover()</button>
  <button interesttarget="mypopover-instance" interestfor="mypopover-instance" class="btn btn-interest">
    interest invoker (Experimental)
  </button>
  <button id="clear-btn" class="btn">Clear log</button>
</div>

<pre
  id="event-log"
  style="
    background: #eee;
    padding: 10px;
    border-radius: 4px;
    font-size: 12px;
    max-height: 150px;
    overflow: auto;
    margin-top: 10px;
  "
></pre>

<div id="mypopover-instance" popover="manual" class="popover-content">
  <p>
    This popover is controlled using: <br />
    <code>HTMLElement.showPopover()</code><br />
    <code>HTMLElement.hidePopover()</code><br />
    <code>HTMLElement.togglePopover()</code>
  </p>
  <p>
    Experimental events: <br />
    <code>interest</code> / <code>loseinterest</code> <br />
    <code>beforetoggle</code> / <code>toggle</code>
  </p>
  <button popovertarget="mypopover-instance" popovertargetaction="hide" class="btn btn-close">Close</button>
</div>

<script>
  {
    const popover = document.getElementById("mypopover-instance");
    const log = document.getElementById("event-log");

    let count = 0;
    const logEvent = (name, details) => {
      count++;
      const entry = document.createElement("div");
      const paddedCount = count.toString().padStart(4, " ");
      entry.textContent = `${paddedCount}: ${new Date().toLocaleTimeString()} - ${name}${
        details ? ` (${details})` : ""
      }`;
      log.prepend(entry);
    };

    document.getElementById("show-btn").onclick = () => popover.showPopover();
    document.getElementById("hide-btn").onclick = () => popover.hidePopover();
    document.getElementById("toggle-btn").onclick = () => popover.togglePopover();
    document.getElementById("clear-btn").onclick = () => {
      log.textContent = "";
      count = 0;
    };

    // https://developer.mozilla.org/en-US/docs/Web/API/Popover_API#events
    popover.addEventListener("beforetoggle", (e) => {
      logEvent("beforetoggle", `newState: ${e.newState}, oldState: ${e.oldState}`);
    });

    popover.addEventListener("toggle", (e) => {
      logEvent("toggle", `newState: ${e.newState}, oldState: ${e.oldState}`);
    });

    // Interest Invokers (Experimental)
    popover.addEventListener("interest", () => logEvent("interest"));
    popover.addEventListener("loseinterest", () => logEvent("loseinterest"));
  }
</script>

<style>
  #mypopover-instance::backdrop {
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(1px);
  }
  #event-log:empty::before {
    content: "Events will be logged here...";
    color: #888;
    font-style: italic;
  }
  .btn-interest {
    background: #e1f5fe;
    border-color: #03a9f4;
    color: #01579b;
  }
  .btn-interest:hover {
    background: #b3e5fc;
  }
</style>
