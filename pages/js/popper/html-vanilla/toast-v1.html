<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Toast popovers example</title>
    <style>
      .failure {
        background: rgb(255, 100, 100);
      }

      .success {
        background: rgb(50, 255, 50);
      }

      :popover-open {
        position: absolute;
        inset: unset;
        right: 5px;
        bottom: 5px;
      }
    </style>
    <script src="index.js" defer></script>
  </head>
  <body>
    <button id="success-toast-btn">Generate success toast</button>
    <button id="failure-toast-btn">Generate fail toast</button>

    <p>Successes: 0. Failures: 0.</p>
    <script>
      const successToastBtn = document.getElementById("success-toast-btn");
      const failureToastBtn = document.getElementById("failure-toast-btn");
      const counter = document.querySelector("p");

      let successCount = 0;
      let failCount = 0;

      function makeToast(result) {
        // Create an element and make it into a popover
        const popover = document.createElement("article");
        popover.popover = "manual";
        popover.classList.add("toast");
        popover.classList.add("newest");

        let msg;

        // Give the toast an appropriate text content, class for styling, and update
        // the relevant count, depending on whether it was a success or a failure
        if (result === "success") {
          msg = "Action was successful!";
          popover.classList.add("success");
          successCount++;
        } else if (result === "failure") {
          msg = "Action failed!";
          popover.classList.add("failure");
          failCount++;
        } else {
          return;
        }

        // Give the toast its text content, and add it to the DOM
        popover.textContent = msg;
        document.body.appendChild(popover);

        // Show the popover
        popover.showPopover();

        // Update the counter paragraph
        updateCounter();

        // Remove the toast again after 4 seconds
        setTimeout(() => {
          popover.hidePopover();
          popover.remove();
        }, 4000);

        // When a new toast appears, run the movetoastsUp() function
        popover.addEventListener("toggle", (event) => {
          if (event.newState === "open") {
            moveToastsUp();
          }
        });
      }

      function moveToastsUp() {
        const toasts = document.querySelectorAll(".toast");

        toasts.forEach((toast) => {
          // If the toast is the one that has just appeared, we don't want it to move up.
          if (toast.classList.contains("newest")) {
            toast.classList.remove("newest");
          } else {
            // Move up all the other toasts by 50px to make way for the new one
            const currentBottom = parseInt(getComputedStyle(toast).bottom);
            toast.style.bottom = `${currentBottom + 50}px`;
          }
        });
      }

      function updateCounter() {
        // Update the counter paragraph with the new count each time a new toast is generated
        counter.textContent = `Successes: ${successCount}. Failures: ${failCount}.`;
      }

      // Handlers to wire up the buttons to the makeToast() function
      successToastBtn.addEventListener("click", () => {
        makeToast("success");
      });

      failureToastBtn.addEventListener("click", () => {
        makeToast("failure");
      });
    </script>

    <br />
    <p>
      source:
      <a
        href="https://mdn.github.io/dom-examples/popover-api/#:~:text=Illustrates%20how%20to%20make%20a%20simple%20system%20of%20%E2%80%9Ctoast%E2%80%9D"
        >demo-examples</a
      >
    </p>
    <br />
    <p>
      from: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Popover_API#examples">developer.mozilla.org</a>
    </p>
  </body>
</html>
