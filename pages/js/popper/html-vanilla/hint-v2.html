<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      :root {
        --offset: 10px;
      }
      #handler,
      #handler2 {
        z-index: 1;
        background-color: white;
        position: absolute;
        width: max-content;
        span {
          border: 1px solid #ccc;
          cursor: pointer;
          padding: 3px;
          user-select: none;
        }
        border: 1px solid blueviolet;
        padding: 5px;
      }
      #handler2 {
        left: 550px;
        border-color: forestgreen;
      }
      body [popover] {
        margin: 10px;
        box-shadow: 0 0 8px #616060;
      }
      .radios {
        display: inline-grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 5px;
        padding: 10px;
        border: 1px solid #ccc;
        label {
          display: flex;
          align-items: center;
          gap: 5px;
          padding: 3px 8px;
          border: 1px solid #eee;
          cursor: pointer;
        }
        label:hover {
          background: #f9f9f9;
        }
      }
    </style>
    <link rel="stylesheet" href="popover.css" />
  </head>
  <body class="layout bg" toc>
    <div class="radios">
      <label title="topleft"> <input type="radio" name="position" value="topleft" /> </label>
      <label title="top"> <input type="radio" name="position" value="top" /> </label>
      <label title="topright"> <input type="radio" name="position" value="topright" /> </label>

      <label title="left"> <input type="radio" name="position" value="left" /> </label>
      <label title="center"> <input type="radio" name="position" value="center" /> </label>
      <label title="right"> <input type="radio" name="position" value="right" /> </label>

      <label title="bottomleft"> <input type="radio" name="position" value="bottomleft" /> </label>
      <label title="bottom"> <input type="radio" name="position" value="bottom" /> </label>
      <label title="bottomright"> <input type="radio" name="position" value="bottomright" /> </label>
    </div>
    <div style="margin-top: 10px">
      Offset: <input type="range" id="offsetRange" min="0" max="100" />
      <span id="offsetVal"></span>
      <label style="margin-left: 20px">
        <input type="checkbox" id="blockHorizontal" /> block horizontal checkbox
      </label>
    </div>
    <hr />

    <div id="handler">
      <span>Dragging Handler</span>
      <button popovertarget="bindhover">html-vanilla/popover.css</button>
      <span>Dragging Handler</span>
    </div>
    <div id="bindhover" popover="manual" data-popover contenteditable>
      This is popover [contenteditable] 1
      <button popovertarget="bindhover" popovertargetaction="hide">Close</button>
    </div>

    <div id="handler2">
      <span>Hover Handler</span>
      <!-- <button popovertarget="popoverhover" data-popover-hover="3000:5000">This is anchor (hover): Show popover</button> -->
      <button popovertarget="popoverhover" data-popover-hover>popover.css + bindHover.js</button>
      <span>Hover Handler</span>
    </div>
    <div id="popoverhover" popover="manual" data-popover contenteditable>
      <pre>
import bindHover from "./bindHover.js";
import bindHover from "urlwizzard.schema://urlwizzard.hostnegotiated/pages/js/popper/html-vanilla/bindHover.js";

bindHover();
</pre
      >
      <button popovertarget="popoverhover" popovertargetaction="hide">Close</button>
    </div>

    <script type="module">
      import handleRadio from "../../../html/handleRadio.js";
      import drag, { getStyle } from "../../../../libs/drag.js";

      import "/js/preprocessed.js";
      import urlwizzard from "/js/urlwizzard.js";

      await urlwizzard();

      // urlwizzard.schema://urlwizzard.hostnegotiated/pages/js/popper/html-vanilla/popover.css
      import bindHover from "./bindHover.js";
      bindHover();

      const element = document.querySelector('[popovertarget="bindhover"]').parentNode;

      drag(
        element,
        (x, y) => {
          element.style.left = `${x}px`;
          element.style.top = `${y}px`;
        },
        () => {
          const s = getStyle(element);
          return { x: parseInt(s.left, 10) || 0, y: parseInt(s.top, 10) || 0 };
        }
      );

      drag(
        document.getElementById("handler2"),
        (x, y) => {
          const el = document.getElementById("handler2");
          el.style.left = `${x}px`;
          el.style.top = `${y}px`;
        },
        () => {
          const s = getStyle(document.getElementById("handler2"));
          return { x: parseInt(s.left, 10) || 0, y: parseInt(s.top, 10) || 0 };
        }
      );

      function radioChange(value) {
        const popovers = document.querySelectorAll("[data-popover]");
        popovers.forEach((popover) => {
          popover.classList.remove(
            "topleft",
            "top",
            "topright",
            "left",
            "center",
            "right",
            "bottomleft",
            "bottom",
            "bottomright"
          );
          popover.classList.add(value);
        });
        console.log("radioChanged: ", value);
      }

      handleRadio({
        name: "position",
        delegateParent: document.querySelector(".radios"),
        initState: "top",
        // initTrigger: true,
        onChange: radioChange,
      });

      const popover = document.getElementById("bindhover");
      const invoker = document.querySelector(`[popovertarget="${popover.id}"]`);

      popover.showPopover({
        source: invoker,
      }); // enable by default

      const offsetRange = document.getElementById("offsetRange");
      const offsetVal = document.getElementById("offsetVal");

      // Initialize from CSS
      const initialOffset = getComputedStyle(popover).getPropertyValue("--offset").trim();
      const initialValue = parseInt(initialOffset, 10) || 0;
      offsetRange.value = initialValue;
      offsetVal.textContent = `${initialValue}px`;

      offsetRange.addEventListener("input", (e) => {
        const val = e.target.value;
        const popovers = document.querySelectorAll("[data-popover]");
        popovers.forEach((p) => {
          p.style.setProperty("--offset", `${val}px`);
        });
        offsetVal.textContent = `${val}px`;
      });

      const blockHorizontal = document.getElementById("blockHorizontal");
      blockHorizontal.addEventListener("change", (e) => {
        document.body.style.overflowX = e.target.checked ? "hidden" : "auto";
      });
    </script>
    <br />
    <br />
    <br />
    <ace-editor lang="html">
      <script type="ace">

        &lt;script type="module">
          import drag, { getStyle } from "urlwizzard.schema://urlwizzard.hostnegotiated/libs/drag.js";

          const parent = document.querySelector('[popovertarget="elementid"]').parentNode;
          const handle = parent.querySelector('span');
          drag(
            handle,
            (x, y) => {
              parent.style.left = `${x}px`;
              parent.style.top = `${y}px`;
            },
            () => {
              const s = getStyle(parent);
              return { x: parseInt(s.left, 10) || 0, y: parseInt(s.top, 10) || 0 };
            }
          );
        &lt;/script>

        <link rel="stylesheet" href="urlwizzard.schema://urlwizzard.hostnegotiated/pages/js/popper/html-vanilla/popover.css" />

        <div style="position: absolute">
          <span style="cursor: move">|||</span>
          <button popovertarget="elementid" popovertargetaction="show">anchor</button>
        </div>

        <div id="elementid" popover="manual" data-popover contenteditable>
          stuff in popover
          <button popovertarget="elementid" popovertargetaction="hide">Close</button>
        </div>
      </script>
    </ace-editor>
    <br />

    <script type="module">
      import drag, { getStyle } from "/libs/drag.js";

      const parent = document.querySelector('[popovertarget="elementid"]').parentNode;
      const handle = parent.querySelector("span");
      drag(
        handle,
        (x, y) => {
          parent.style.left = `${x}px`;
          parent.style.top = `${y}px`;
        },
        () => {
          const s = getStyle(parent);
          return { x: parseInt(s.left, 10) || 0, y: parseInt(s.top, 10) || 0 };
        }
      );
    </script>
    <div style="position: absolute">
      <span style="cursor: move">|||</span>
      <button popovertarget="elementid" popovertargetaction="show">anchor</button>
    </div>
    <div id="elementid" popover="manual" popover data-popover contenteditable>
      stuff in popover
      <button popovertarget="elementid" popovertargetaction="hide">Close</button>
    </div>
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <p>stuff</p>
    <hr />
    <script
      type="module"
      src="https://stopsopa.github.io/ace-editor-webcomponent/ace-web-component.js"
      data-main-ace="https://stopsopa.github.io/ace-editor-webcomponent/noprettier/ace/ace-builds-1.43.4/src-min-noconflict/ace.js"
    ></script>
  </body>
</html>
