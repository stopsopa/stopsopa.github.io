<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>stopsopa.github.io</title>
    <script src="/js/github.js"></script>
</head>
<body class="layout" toc>

    <div class="body">
        <div class="inside">

            <div class="cards">

                <h2>Node</h2>
                <a href="/pages/js/node/index.html">node</a>
                <h2>React - es6 syntax snippets</h2>
                <a href="https://gist.github.com/stopsopa/3f076fd92b03136cc28b8b91a1ffdad8#file-js-es6-jsx-L323">https://gist.github.com/stopsopa/3f076fd92b03136cc28b8b91a1ffdad8#file-js-es6-jsx-L323</a>

                <h2>inheritance</h2>
                <a href="/research/js/008-inheritance.html">/research/js/008-inheritance.html</a>
                <h2>jest</h2>
                <a href="https://github.com/stopsopa/roderic-legacy/tree/master/test/jest">https://github.com/stopsopa/roderic-legacy/tree/master/test/jest</a>

                <h2>mouseenter, mouseleave, mouseover, mouseout, input[type="range"]</h2>
                <a href="/other/selectors/#hover">hover</a>

                <h2>UMD (Universal Module Definition)</h2>
                <a href="https://github.com/umdjs/umd#tooling">https://github.com/umdjs/umd#tooling</a>
                <br />
                <a href="https://gist.github.com/stopsopa/8297755373fd5be34165cc8e12d35642">gist (UMD - browser global & node module (singleton))</a>

                <script type="editor" data-lang="js">
                
(function (root, name, factory) {

    var log=(function(){try{return console.log}catch(e){return function (){}}}());

    var node = typeof global !== 'undefined' && Object.prototype.toString.call(global.process) === '[object process]';

    try {
        // const instance = factory(root, root.b, log, node);
        const instance = factory(root, log, node);

        const nc = root[name];

        instance.noConflict || (instance.noConflict = function(){root[name]=nc;return instance})

        // Browser globals
        root[name] = instance;
    }
    catch (e) {
        log("UMD (" + name + "): can't assign to root, reason: ", e + '');
    }

    if (typeof module === 'object' && module.exports) {
        // Node. Does not work with strict CommonJS, but
        // only CommonJS-like environments that support module.exports,
        // like Node.
        //module.exports = factory({}, require('b'), log, node);
        module.exports = factory(root, log, node);
    }

}(typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : this), 'lib', function (root, log, node) {

    // root - is just for access
    // node - to detect if this is node environment

    // just build tool and return, don't worry about attaching do window|object (browser mode)
    var tool = function () {};

    return tool;

}));

                </script>
                <h2>safe console.log</h2>
                <script type="editor" data-lang="js">

// just log
var log=(function(){try{return console.log}catch(e){return function(){}}}());

// tlog
const tlog = (function () {

    var log=(function(){try{return console.log}catch(e){return function(){}}}());

    const time = () => (new Date()).toISOString().substring(0, 19).replace('T', ' ')

    return (...args) => {
        log.call(this, time(), ...args.map(a => a + ''));
    }
}());

// module
const log=(function(){try{return console.log}catch(e){return function(){}}}());

const time = () => (new Date()).toISOString().substring(0, 19).replace('T', ' ')

module.exports = (...args) => {
    log.call(this, time(), ...args.map(a => a + ''));
}

// node inspect
const i = require('util').inspect;

console.log(i(t, {
    depth:  50,
    colors: true,
    compact: true,
    // breakLength: 80,
}))                

                </script>
                <h2>manipulation</h2>
                <script type="editor" data-lang="js">

var manipulation = (function () {

    var domCache = document.createElement('div');

    return {
        after: function (referenceNode, newNode) {
            return this.before(referenceNode.nextSibling, newNode);
        },
        before: function (referenceNode, newNode) {
            referenceNode.parentNode.insertBefore(newNode, referenceNode);
            return this;
        },
        append: function (parentNode, newNode) {
            parentNode.appendChild(newNode);
            return this;
        },
        prepend: function (parentNode, newNode) {
            parentNode.insertBefore(newNode, parentNode.firstChild);
            return this;
        },
        remove: function (node) {
            node.parentNode.removeChild(node);
            return this;
        },
        detach: function (element) { // detach element from DOM, to use it somewhere else
            this.append(domCache, element);
            return element;
        },
        empty: function (element) {
            element.innerHTML = '';
            return this;
        },
        children: function (parent) {
            try {
                // read also about
                // https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType
                // https://developer.mozilla.org/en-US/docs/Web/API/Element/tagName  - undefined when #text node
                // https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeName
                return Array.prototype.slice.call(parent.childNodes)
            }
            catch (e) {

                throw new Error("manipulation.children() error: " + String(e));
            }
        },
    };
}());

                </script>
                <h2>inheritance</h2>
                <script type="editor" data-lang="js">
        function Shape () {
        }
        function Rectangle () {
            Shape.apply(this, arguments)
        }
        Rectangle.prototype = Object.create(Shape.prototype);
        Rectangle.prototype.constructor = Rectangle;
        Rectangle.prototype.getArea = function () {
        }
                </script>
                <h2>instance or function</h2>
                <script type="editor" data-lang="js">

const log = console.log;

log('=== test 1 ===')

// always new instance
function inst(...args) {

    //if (this.constructor != deferred)
    if ( ! (this instanceof inst) )
        return new inst(...args);

console.log("created:", args);

    this.args = args;

    this.ret = function () {
        return this.args;
    }
}

var a = inst('a');
var b = new inst('b');

log(a.ret())
log(b.ret())

log('=== test 2 ===')

// can be called only as a function
function func(...args) {

    //if (this.constructor != deferred)
    if ( this instanceof func )
        throw new Error( `Can't create instance of function 'func' just use it as a function` );

    console.log("created:", args);

    args.push('end');

    return args;
}

log(func('a'));

try {

    var b = new func('b');
}
catch (e) {

    log(String(e))
}

// === test 1 ===
// created: [ 'a' ]
// created: [ 'b' ]
//     [ 'a' ]
//     [ 'b' ]
// === test 2 ===
// created: [ 'a' ]
//     [ 'a', 'end' ]
// Error: Can't create instance of function 'func' just use it as a function    

// Try also put this code to Typescript playground and see output
// take look at generated __extends function
// Change output syntax (In "TS Config" tab) to "ES5"
// example from: https://www.typescriptlang.org/docs/handbook/classes.html#inheritance
class Animal {
  move(distanceInMeters: number = 0, t: number ) {
    log(`Animal moved ${distanceInMeters}m.`);
  }
}

class Dog extends Animal {
  bark() {
    log("Woof! Woof!");
  }
}

const dog = new Dog();
dog.bark();
dog.move(10, 5);
dog.bark();

                </script>
                <h2>system info</h2>
                <script type="editor" data-lang="js">
                
npx envinfo

                </script>
                <h2>Date months</h2>
                <script type="editor" data-lang="js">
var monthName = (function () {

    const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];

    return function (date) {

        return monthNames[date.getUTCMonth()];
    }
}());
                </script>
                <h2>serializeError</h2>
                <script type="editor" data-lang="js">
                

/**
 * https://github.com/sindresorhus/serialize-error
 */
const serializeError = (function () {

    'use strict';

    const commonProperties = [
        {property: 'name', enumerable: false},
        {property: 'message', enumerable: false},
        {property: 'stack', enumerable: false},
        {property: 'code', enumerable: true}
    ];

    const destroyCircular = ({from, seen, to_, forceEnumerable}) => {
        const to = to_ || (Array.isArray(from) ? [] : {});

        seen.push(from);

        for (const [key, value] of Object.entries(from)) {
            if (typeof value === 'function') {
                continue;
            }

            if (!value || typeof value !== 'object') {
                to[key] = value;
                continue;
            }

            if (!seen.includes(from[key])) {
                to[key] = destroyCircular({from: from[key], seen: seen.slice(), forceEnumerable});
                continue;
            }

            to[key] = '[Circular]';
        }

        for (const {property, enumerable} of commonProperties) {
            if (typeof from[property] === 'string') {
                Object.defineProperty(to, property, {
                    value: from[property],
                    enumerable: forceEnumerable ? true : enumerable,
                    configurable: true,
                    writable: true
                });
            }
        }

        return to;
    };

    const serializeError = value => {
        if (typeof value === 'object' && value !== null) {
            return destroyCircular({from: value, seen: [], forceEnumerable: true});
        }

        // People sometimes throw things besides Error objects…
        if (typeof value === 'function') {
            // `JSON.stringify()` discards functions. We do too, unless a function is thrown directly.
            return `[Function: ${(value.name || 'anonymous')}]`;
        }

        return value;
    };

    return serializeError
}());

                </script>
                <h2>trim</h2>
                <script type="editor" data-lang="js">

/*!
 * @version 1.0 - 2013-05-21
 * @author Szymon Działowski
 * direction : 'rl'|'r'|'l'   -->   (undefined => 'rl')
 * charlist  : (undefined => " \n")
 */ 
function trim(string, charlist, direction) {
  direction = direction || 'rl';
  charlist  = (charlist || '').replace(/([.?*+^$[\]\\(){}|-])/g,'\\$1');
  charlist  = charlist || " \\n";
  (direction.indexOf('r')+1) && (string = string.replace(new RegExp('^(.*?)['+charlist+']*$','gm'),'$1'));
  (direction.indexOf('l')+1) && (string = string.replace(new RegExp('^['+charlist+']*(.*)$','gm'),'$1'));  
  return string;  
}   
                    
                </script>
                <h2>Proxy getter</h2>
                <script type="editor" data-lang="js">
let target = {
    a: 'b',
    c: 'd',
};

let handler = {
    get(target, propKey, receiver) {

        if (typeof target[propKey] !== 'undefined') {

            return target[propKey];
        }

        const keys = Object.keys(target);

        throw `No such manager '${propKey}', registered managers: ` + keys.join(', ');
    }
};
let proxy = new Proxy(target, handler);

console.log(proxy.a);
console.log(proxy.c);
console.log(proxy.b);           
                </script>
                <h2>Event Delegation</h2>
                <script type="editor" data-lang="js">

    // https://developer.mozilla.org/en-US/docs/Web/API/Element/matches#Polyfill
    if (!Element.prototype.matches) {
        Element.prototype.matches =
            Element.prototype.matchesSelector ||
            Element.prototype.mozMatchesSelector ||
            Element.prototype.msMatchesSelector ||
            Element.prototype.oMatchesSelector ||
            Element.prototype.webkitMatchesSelector ||
            function(s) {
                var matches = (this.document || this.ownerDocument).querySelectorAll(s),
                    i = matches.length;
                while (--i >= 0 && matches.item(i) !== this) {}
                return i > -1;
            };
    }

    document.body.addEventListener('click', function (e) {

        var el = e.target;

        var match = el.matches('[data-lang] > .copy');

        if (match) {

        }
    });

                </script>
                <h2>React - no webpack template</h2>
                <a href="https://reactjs.org/docs/add-react-to-a-website.html">Add React to a Website</a>
                <script type="editor" data-lang="html">
                
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script>
        window.Promise || document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/4.1.1/es6-promise.min.js"><\/script>');
        window.fetch || document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/3.0.0/fetch.min.js"><\/script>');
    &lt;/script>
    <script src="public/react/umd/react.production.min.js">&lt;/script>
    <script src="public/react-dom/umd/react-dom.production.min.js">&lt;/script>
    <script src="public/@babel/standalone/babel.min.js">&lt;/script>
        <!-- 
            yarn add @babel/standalone 
            homepage github repo:
                https://github.com/babel/babel-standalone 
            from cdn:
                https://reactjs.org/docs/add-react-to-a-website.html#quickly-try-jsx
        -->
    <script>window.React || document.write("run server using 'make start' it will link node_modules where it should be");&lt;/script>
</head>
<body>
    <div id="app">
        Loading ...
    </div>
    <script type="text/babel">

        const log=(function(){try{return console.log}catch(e){return function(){}}}());

        const delay = (time, data) =>
            new Promise(
                resolve => time ? setTimeout(resolve, time, data) : resolve(data)
            )
        ;

        class Root extends React.Component {
            constructor(...args) {

                super(...args);

                this.state = {
                }
            }
            render() {
                return (
                    <div>It's working...</div>
                );
            }
        }
        ReactDOM.render(
            <Root
            />,
            document.getElementById('app')
        );
    &lt;/script>
</body>
</html>
        
                </script>
                <h2>Extract computed css property value</h2>
                <script type="editor" data-lang="js">
parseInt(window.getComputedStyle(document.querySelector('svg'), null).getPropertyValue("width"), 10)
                </script>
                <h2>Parsing get parameters, location.search</h2>
                <script type="editor" data-lang="js">
var query = (location.search || '?').substring(1).split('&').filter(a => a).reduce((acc, val) => {

    var
        a       = val.split(/=/),
        key     = a.shift(),
        v       = decodeURIComponent(a.join('='))
    ;

    if (Array.isArray(acc[key])) {
        acc[key].push(v);
    }
    else {
        if (typeof acc[key] === 'string') {
            acc[key] = [acc[key]];
            acc[key].push(v)
        }
        else {
            acc[key] = v;
        }
    }

    return acc;
}, {});                
                </script>
                <h2>fetch</h2>
                <script type="editor" data-lang="js">
// in order to get body and headers fetch require so much magic, this is sick... 
  
var log = console.log;             
var r = await fetch('');

// or:
var t = await r.text()
log(t.substring(0, 300))

// or:
//var j = await r.json()
//log(j)

const h = {}
r.headers.forEach((value, key) => h[key] = value)

//const h = await Promise.all(r.headers.entries());

log('headers', h)

log('oneheader', r.headers.get('Content-type'));
                </script>
                <h2>React - Textarea</h2>
                <script type="editor" data-lang="jsx">


import React, { useEffect, useState, useRef } from 'react';

const Textarea = (function () {

  // https://stackoverflow.com/a/5346855
  var observe;
  if (window.attachEvent) {
    observe = function (element, event, handler) {
      element.attachEvent('on'+event, handler);
    };
  }
  else {
    observe = function (element, event, handler) {
      element.addEventListener(event, handler, false);
    };
  }
  function init (text, correct) {
    function resize () {
      console.log('fun resize', text)
      text.style.height = 'auto';
      var h = text.scrollHeight;
      if (Number.isInteger(correct)) {
        h += correct;
      }
      text.style.height = h+'px';
    }
    /* 0-timeout to get the already changed text */
    function delayedResize () {
      window.setTimeout(resize, 0);
    }
    observe(text, 'change',  resize);
    observe(text, 'cut',     delayedResize);
    observe(text, 'paste',   delayedResize);
    observe(text, 'drop',    delayedResize);
    observe(text, 'keydown', delayedResize);

    // text.focus();
    // text.select();
    resize();

    return function () {resize()}
  }

  return props => {

    const el = useRef(null);

    const [ resize, setResize ] = useState(false);

    const [ mounted, setMounted ] = useState(false);

    const {
      value,
      correct,
    } = props;

    useEffect(() => {

      if ( ! mounted && el.current ) {

        setMounted(true);

        setResize(init(el.current, correct));
      }

      (typeof resize === 'function') && resize();
    }, [value]);

    return (
      <textarea ref={el} {...props} />
    )
  }
}());

                </script>
                <h2>codepen, jsfiddle, codesandbox</h2>
                <a href="https://codesandbox.io/s/rjj38yzm14">codesandbox template</a>
            </div>
        </div>
    </div>
</body>
</html>
